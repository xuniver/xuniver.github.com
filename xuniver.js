function get_ordinal(b){var a=b%10;if(a===1&&b!==11){return"st"}else{if(a===2&&b!==12){return"nd"}else{if(a===3&&b!==13){return"rd"}else{return"th"}}}}$.fn.randomize=function(a){(a?this.find(a):this).parent().each(function(){$(this).children(a).sort(function(){return Math.random()-0.5}).detach().appendTo(this)});return this};if($.validator){$.validator.addMethod("isbn",function(b,a){return this.optional(a)||ISBN.parse(b.replace(/-/g,""))},"Please provide a valid ISBN.");$.validator.setDefaults({})}var Xuniver={ensure_csrf:function(){if(Cookies.enabled){var a=Cookies.get("csrftoken");if(!a){$.get("/accounts/csrf/")}}},check_imgur_url:function(a){return/^http:\/\/i\.imgur\.com\/[0-9a-zA-Z]{5,8}\.(jpg|png)$/.test(a)},make_sell_offer:function(){Xuniver.make_sell_offer_image_selector();$("#id_price").focus();$("#id_message").limit("1000",$("#sell-offer-textarea-remaining"));$("#sell-offer-form").validate({errorLabelContainer:$(".make-sell-offer .errors"),rules:{message:{required:true},price:{required:true,number:true}},messages:{message:"Please provide a description.",price:"Please provide a valid price."}})},make_sell_offer_image_selector:function(){var b=$("#upload-image-dialog");var a=$(".upload-image-dialog-alert");$("#id_image_url").on("input",function(){var d="http://i.imgur.com/";var c=$("#id_image_url");var e=c.val();if(e.search(d)==0){c.val(e.slice(d.length))}$(".upload-image-dialog-alert").slideUp()});b.on("hidden",function(){$image_url=$("#id_image_url");if(!Xuniver.check_imgur_url("http://i.imgur.com/"+$image_url.val())){var c=$(".make-sell-offer-image");c.find("img").attr("src",c.attr("default-image"));$(".upload-image-dialog-alert").hide();$image_url.val("")}});b.find(".upload-image-save").click(function(){var c=$("#id_image_url");var d="http://i.imgur.com/"+c.val();if(!/\.(jpg|png)$/.test(d)){a.html("The image URL you provided does not have an allowed file extension.");a.show()}else{if(!Xuniver.check_imgur_url(d)){a.html("The image URL you provided is invalid.");a.show()}else{$("<img>",{src:d,error:function(){var e=$(".upload-image-dialog-alert");e.html("The image URL you provided is not valid.");e.show()},load:function(){$(".upload-image-dialog-alert").hide();$(".make-sell-offer-image img").attr("src",d);$("#upload-image-dialog").modal("toggle")}})}}});$("#sell-offer-form").submit(function(){var c=$("#id_image_url");var d=c.val();if(d){c.val("http://i.imgur.com/"+c.val())}});$(".make-sell-offer-image").click(function(){$("#upload-image-dialog").modal()})},view_sell_offer:function(){Xuniver.ensure_csrf();$(".sell-offer-reply-button").click(function(){$("#id_csrf").val(Cookies.get("csrftoken"))})},book_search_bar:function(){var a=$("#book-search-bar-form");a.validate({rules:{isbn:{required:{depends:function(){$(this).val($.trim($(this).val()));return true}},isbn:true}},errorLabelContainer:$(".book-search-bar .errors"),messages:{isbn:"Please enter a valid ISBN."}});a.submit(function(){if(!$(this).valid()){return false}var b=ISBN.asIsbn13((a.find('[name="isbn"]').val().replace(/-/g,"")));location.href="/find/"+b+"/"})},page_load:{find_sell_offers:function(){$(".make-sell-offer-container").hide();$(".sell-offer-toggle-button").on("click.sell-offer-toggle",function(){$(".make-sell-offer-container").load("/ajax/sell-offer-form/",function(f,a,c){var e=$("#find-sell-offers-modal");if(c.status=="403"){e.find(".modal-header h3").html("You aren't logged in.");e.find(".modal-body").html("<p>You must be logged in before you can submit an offer.</p>");e.find(".modal-footer").html('<a class="btn btn-primary" href="/accounts/?next='+window.location.pathname+'">Log in</a><button class="btn" type="button" data-dismiss="modal" aria-hidden="true">Cancel</button>');e.modal();return}Xuniver.ensure_csrf();var b=$(".book-info").attr("isbn");$(".make-sell-offer-container").find('input[name="book"]').val(b);Xuniver.make_sell_offer();var d=$(".sell-offer-toggle-button");d.off("click.sell-offer-toggle");d.click(function(){$(".make-sell-offer-container").slideToggle()});$(this).slideToggle()})});$(".demand-book-button").click(function(){Xuniver.ensure_csrf();var b=Cookies.get("csrftoken");var a=$(".book-info").attr("isbn");if(typeof a!=="undefined"&&a!==false){$.post("/accounts/demand-book/",{isbn:a,csrfmiddlewaretoken:b}).done(function(f,c,d){var e=$("#find-sell-offers-modal");if(f=="1"){$(".demand-book-count").html(parseInt($(".demand-book-count").html(),10)+1);$(".demand-book-button").addClass("already-voted");e.find(".modal-header h3").html("Success");e.find(".modal-body").html("<p>Your vote has been submitted. Thanks for voting!</p>");e.find(".modal-footer").html('<button class="btn" data-dismiss="modal" aria-hidden="true">OK</button>');e.modal()}else{e.find(".modal-header h3").html("Already voted");e.find(".modal-body").html("<p>You have already upvoted this book.</p>");e.find(".modal-footer").html('<button class="btn" data-dismiss="modal" aria-hidden="true">OK</button>');e.modal()}}).fail(function(c,f,e){var d=$(".find-sell-offers .modal");if(c.status=="403"){d.find(".modal-header h3").html("You aren't logged in.");d.find(".modal-body").html("<p>You must be logged in before you can vote.</p>");d.find(".modal-footer").html('<a class="btn btn-primary" href="/accounts/?next='+window.location.pathname+'">Log in</a><button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>');d.modal()}})}});$(".thumbnails").imagesLoaded(function(){$(".thumbnails").masonry({isAnimated:true})})},user_sell_offer_history:function(){$(".delete-offer-button").click(function(){var b=$("#delete-offer-dialog");var a=$(this).attr("offer-id");if(typeof a!=="undefined"&&a!==false){b.find(".delete-offer-confirm").off("click.delete_offer_dialog");b.find(".delete-offer-confirm").on("click.delete_offer_dialog",function(){$.post("/accounts/delete-sell-offer/",{offer_id:a,csrfmiddlewaretoken:$('[name="csrfmiddlewaretoken"]').val()},function(e,c,d){location.reload(true)})});b.modal()}})},frontpage:function(){Xuniver.book_search_bar();var a=$(".frontpage-books");a.randomize(".frontpage-book")},all:function(){}}};$(function(){Xuniver.page_load.all()});